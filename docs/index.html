<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ConfluenceClient.html">ConfluenceClient</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#.isValidInteger">isValidInteger</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#.isValidLabelName">isValidLabelName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#.isValidSpaceKey">isValidSpaceKey</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#.isValidURL">isValidURL</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#addPageLabels">addPageLabels</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#createPage">createPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#enableDebugMessages">enableDebugMessages</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#getLastErrorMessage">getLastErrorMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#getRestMessageObject">getRestMessageObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#loadPageChildren">loadPageChildren</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#loadPageDataById">loadPageDataById</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#loadPageDataByTitle">loadPageDataByTitle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#loadPageDescendants">loadPageDescendants</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#loadScaffoldingData">loadScaffoldingData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#removePage">removePage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#removePageLabel">removePageLabel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#searchPages">searchPages</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#updatePageData">updatePageData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#updatePageLabels">updatePageLabels</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluenceClient.html#updateScaffoldingData">updateScaffoldingData</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ConfluencePage.html">ConfluencePage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#addLabel">addLabel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getAncestors">getAncestors</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getBody">getBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getGroupReadingRestrictions">getGroupReadingRestrictions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getGroupUpdatingRestrictions">getGroupUpdatingRestrictions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getId">getId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getLabels">getLabels</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getModificationDateTime">getModificationDateTime</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getModifierDisplayName">getModifierDisplayName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getModifierUserName">getModifierUserName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getParentPageId">getParentPageId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getRenderedHTML">getRenderedHTML</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getScaffoldingData">getScaffoldingData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getScaffoldingValue">getScaffoldingValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getSpaceKey">getSpaceKey</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getStatus">getStatus</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getTitle">getTitle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getUserReadingRestrictions">getUserReadingRestrictions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getUserUpdatingRestrictions">getUserUpdatingRestrictions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#getVersionNumber">getVersionNumber</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#hasLabel">hasLabel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#increaseVersionNumber">increaseVersionNumber</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#isValid">isValid</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#loadScaffoldingData">loadScaffoldingData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#remove">remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#removeLabel">removeLabel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setBody">setBody</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setId">setId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setParentPageId">setParentPageId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setScaffoldingData">setScaffoldingData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setScaffoldingValue">setScaffoldingValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setSpaceKey">setSpaceKey</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setStatus">setStatus</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setTitle">setTitle</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#setVersionNumber">setVersionNumber</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#stringify">stringify</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#update">update</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#updatePageData">updatePageData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#updatePageLabels">updatePageLabels</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ConfluencePage.html#updateScaffoldingData">updateScaffoldingData</a></span></li>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h2>About ConfluenceClient</h2>
<h3>Summary</h3>
<p>The ConfluenceClient API allows a ServiceNow instance to connect to a remote Confluence instance and provides a number of convenient methods for handling with Confluence content like searching or modififying pages.
<br/>
<br/></p>
<h3>Motivation</h3>
<p>The motivation for this project resulted from the following situation: In my company we have an on premise installation of Confluence with lots of plugins - including &quot;Scaffolding&quot; from ServiceRocket. In one of the Confluence spaces exist more than 14000 pages and a majority of them have forms, which have been implemented by macros of that plugin. Performing some reconstructions on such a huge amount of form pages would cause some urgent problem, as there is no possibility to perform these reconstructions with board tools provided by Confluence. However, both Confluence and the Scaffolding plugin offer a REST based API that allows you to implement just about anything you need:</p>
<ul>
<li>Confluence Server: <a href="https://docs.atlassian.com/ConfluenceServer/rest/latest">https://docs.atlassian.com/ConfluenceServer/rest/latest</a></li>
<li>Confluence Cloud: <a href="https://developer.atlassian.com/cloud/confluence/rest">https://developer.atlassian.com/cloud/confluence/rest</a></li>
<li>Scaffolding Plugin: <a href="https://docs.servicerocket.com/scaffolding/developer-guide/scaffolding-rest-api">https://docs.servicerocket.com/scaffolding/developer-guide/scaffolding-rest-api</a>
<br/>
<br/></li>
</ul>
<p>And so I started implementing a client that encapsulates the REST APIs in simple JavaScript methods, making it very easy to load, modify and return Confluence pages. Currently, the Script Include is limited to methods for handling Confluence pages. However, I'm pleased to get feedback and wishes to extend the Confluence client further, so it's worth watching this project and waiting for the next releases.
<br/>
<br/></p>
<h3>What it is not</h3>
<p>ConfluenceClient is not</p>
<ul>
<li>a ready-to-go application or</li>
<li>an <a href="https://docs.servicenow.com/bundle/paris-servicenow-platform/page/administer/integrationhub/concept/integrationhub.html">IntegrationHub</a> spoke.
<br/>
<br/></li>
</ul>
<h2>Use Cases</h2>
<h3>Bulk Changes</h3>
<p>Retrieve a set of Confluence pages based on a query or on a common ancestor and do some bulk operations such as adding title prefixes, fixing macro code or replacing labels.</p>
<p>Also manipulation of form data provided by the <a href="https://marketplace.atlassian.com/apps/190/scaffolding-forms-templates">Scaffolding Plugin</a> is possible!
<br/>
<br/></p>
<h3>Quality Assurance</h3>
<p>Search for Confluence pages that do not meet the specified quality requirements and trigger appropriate actions such as notifying the page modifier.
<br/>
<br/></p>
<h3>Security Checks</h3>
<p>Crawl a set of Confluence pages and check whether each page has the required minimum restrictions. Especially the writing restrictions are problematic, as they have to be reassigned for each page and are not inherited, unlike the reading restrictions.
<br/>
<br/></p>
<h3>Link Checker</h3>
<p>Iterate over all external links of a Confluence page and check whether URLs are available or not.</p>
<pre class="prettyprint source lang-javascript"><code>var strHrefPattern = /&lt;a.*?href=&quot;(.*?)&quot;/g;

while (arrMatches = strHrefPattern.exec(objPage.getBody())) {
  var strUrl        = arrMatches[1];
  var objHttRequest = new GlideHTTPRequest(strUrl);
  var objGet        = objHttRequest.get();
  
  if (!(objGet && objGet.getStatusCode() == 200)) { 
    gs.error(&quot;URL '&quot; + strUrl + &quot;' is not reachable!&quot;);
  }
}
</code></pre>
<br/>
<h2>Usage</h2>
<p>On <a href="https://developer.servicenow.com/connect.do#!/share/contents/4067296_confluence_client">ServiceNow Share</a> you can find an UpdateSet that consists of one Script Include, which is bound to the global application &quot;Confluence Client&quot;. If you want to have the Script Include in the &quot;Global&quot; scope you can move it there (see <a href="https://docs.servicenow.com/bundle/paris-application-development/page/build/applications/task/t_MoveAppFilesBetweenGlobalApps.html">ServiceNow Documentation</a> on how to do that).
<br/></p>
<p>This repository though is prepared to be used in Visual Source Code together with the <a href="https://docs.servicenow.com/bundle/paris-application-development/page/build/applications/concept/vs-code.html">ServiceNow extension for it</a>.
<br/></p>
<p>When creating a new ConfluenceClient object you just have to specify the URL to your Confluence instance:</p>
<pre class="prettyprint source lang-javascript"><code>var confluenceClient = new ConfluenceClient(&quot;&lt;YOUR DOMAIN>&quot;);
</code></pre>
<br/>
<p>Requests to the configured Confluence instance are done with the help of the <a href="https://developer.servicenow.com/dev.do#!/reference/api/paris/server/sn_ws-namespace/c_RESTMessageV2API">RESTMessageV2 API</a>.</p>
<p>If the addressed Confluence instance is not publicly accessible over the Internet, you can use a <a href="https://docs.servicenow.com/bundle/paris-servicenow-platform/page/product/mid-server/concept/mid-server-landing.html">MID server</a> that is located in the protected network and has web-based access to the target Confluence instance.</p>
<pre class="prettyprint source lang-javascript"><code>confluenceClient.getRestMessageObject().setMIDServer(&quot;&lt;YOUR MID SERVER NAME>&quot;);
</code></pre>
<br/>
<p>Authentication against the Confluence can be done in several ways:</p>
<p>(1) set username and password in your code directly (not recommended!)</p>
<pre class="prettyprint source lang-javascript"><code>confluenceClient.getRestMessageObject().setBasicAuth(&quot;&lt;USERNAME>&quot;, &quot;&lt;PASSWORD>&quot;);
</code></pre>
<p>(2) use Authentification Profile (for more information please see <a href="https://docs.servicenow.com/bundle/paris-application-development/page/integrate/outbound-rest/concept/c_OutboundRESTAuth.html">documentation</a> and <a href="https://developer.servicenow.com/dev.do#!/reference/api/paris/server/sn_ws-namespace/c_RESTMessageV2API#r_RMV2-setAuthenticationProfile_S_S">API reference</a>)</p>
<pre class="prettyprint source lang-javascript"><code>confluenceClient.getRestMessageObject().setAuthenticationProfile(&quot;basic&quot;, &quot;&lt;SYS ID>&quot;);
</code></pre>
<br/>
<p>Now you can start requesting Confluence, for example load a single page by its space key and title:</p>
<pre class="prettyprint source lang-javascript"><code>var objPage = confluenceClient.loadPageDataByTitle(&quot;TST&quot;, &quot;2020-07-24 - Team Meeting&quot;);
</code></pre>
<br/>
<h2>Full Example</h2>
<p>The following example code demonstrates how to repair Confluence pages by replacing a broken macro with a fixed version of it:</p>
<pre class="prettyprint source lang-javascript"><code>var brokenMacro = '&lt;ri:page ri:space-key=&quot;[ContentPage] Protocol&quot; ri:content-title=&quot; Team-Meeting &gt; renderJiraReminder&quot; />';
var fixedMacro = '&lt;ri:page ri:content-title=&quot;[ContentPage] Protocol &gt; Team-Meeting &gt; renderJiraReminder&quot; />';
 
// Instantiate a Confluence Client object with the URL of your Confluence instance
// Note: replace &lt;YOUR DOMAIN> with complete URL to your Confluence instance
var confluenceClient = new ConfluenceClient(&quot;&lt;YOUR DOMAIN>&quot;);
 
// Note: replace &lt;SYS ID> with the sys_id of the corresponding Authentification record
confluenceClient.getRestMessageObject().setAuthenticationProfile(&quot;basic&quot;, &quot;&lt;SYS ID>&quot;);
 
// Load all child pages of given parent page inclusive page content
// Note: replace &lt;PAGE ID> with the ID of your Confluence page
var arrPages = confluenceClient.loadPageChildren(&lt;PAGE ID>, true);
 
if (arrPages != null) {
  gs.info(&quot;Found &quot; + arrPages.length + &quot; pages&quot;);
   
  // Iterate over all pages
  arrPages.forEach(function(objPage) {
    if (objPage.getBody().indexOf(brokenMacro) != -1) {
      // Replace broken macro with fixed version
      objPage.setBody(objPage.getBody().replace(brokenMacro, fixedMacro));
 
      // write page back to Confluence
      if (!objPage.updatePageData()) {
        gs.error(confluenceClient.getLastErrorMessage());
      }
    }
  });
}
else {
  gs.error(confluenceClient.getLastErrorMessage());
}
</code></pre>
<br/>
<br/>
<h2>API documentation</h2>
<p>The JavaScript code is well commented and prepared for generating an HTML based documentation via <a href="https://jsdoc.app/">jsdoc</a>.
You can use the file <code>generate-docs.bat</code> for an example.
<br/>
<br/></p>
<h2>Author</h2>
<p><a href="https://account.servicenow.com/personal-data/11ea1a505/b75059d80/a806e4a75/ae71eB9T9/resume.html">Maik Skoddow</a>
<br/>
<br/></p>
<h2>License</h2>
<p>This project is distributed under the Apache 2.0 license. See <a href="https://www.apache.org/licenses/LICENSE-2.0">https://www.apache.org/licenses/LICENSE-2.0</a> for more information.
<br/>
<br/></p>
<h2>Release Notes</h2>
<h3>v0.6</h3>
<h4>General</h4>
<ul>
<li>Internal refactoring and code optimizations.</li>
<li>Some documentation fixes.</li>
<li>Minor bugfix for updating page data
<br/>
<br/></li>
</ul>
<h3>v0.52</h3>
<h4>General</h4>
<ul>
<li>Internal refactoring and code optimizations.</li>
<li>Some documentation fixes.</li>
<li>When fetching Confluence pages response data now includes information regarding page restrictions. That information is offered by four new getters at <code>ConfluencePage</code>.</li>
</ul>
<h4>Object <code>ConfluenceClient</code></h4>
<ul>
<li>Renamed method <code>loadPageData()</code> to <code>loadPageDataById()</code>.</li>
<li>New method <code>loadPageDataByTitle()</code>allows fetching a Confluence page by its title.</li>
</ul>
<h4>Object <code>ConfluencePage</code></h4>
<p>New methods:</p>
<ul>
<li><code>getUserReadingRestrictions()</code></li>
<li><code>getUserUpdatingRestrictions()</code></li>
<li><code>getGroupReadingRestrictions()</code></li>
<li><code>getGroupUpdatingRestrictions()</code>
<br/>
<br/></li>
</ul>
<h3>v0.51</h3>
<h4>General</h4>
<ul>
<li>Internal refactoring and code optimizations.</li>
</ul>
<h4>Object <code>ConfluenceClient</code></h4>
<p>New methods:</p>
<ul>
<li><code>removePage()</code>: Moves a Confluence page to the recycle bin of corresponding space.</li>
</ul>
<h4>Object <code>ConfluencePage</code></h4>
<p>New methods:</p>
<ul>
<li><code>remove()</code></li>
<li><code>getStatus()</code></li>
<li><code>getAncestors()</code></li>
<li><code>getModifierUserName()</code></li>
<li><code>getModifierFullName()</code></li>
<li><code>getModificationDateTime()</code></li>
</ul></article>
    </section>






</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Tue Dec 29 2020 04:16:35 GMT+0100 (GMT+01:00) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>